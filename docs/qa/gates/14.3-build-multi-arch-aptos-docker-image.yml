# Quality Gate: Story 14.3 - Build Multi-Arch Aptos Docker Image
# Generated by Quinn (Test Architect)
#
# DEPRECATED: 2026-01-31
# This QA gate is for the original Story 14.3 which has been deprecated.
# Epic 14 pivoted from building multi-arch Docker images to using public testnets.
# See docs/stories/28.3.story.md for the replacement story (Add Public Testnet Configuration).
# This gate file is retained for historical reference only.

schema: 1
story: "28.3"
story_title: "Build Multi-Arch Aptos Docker Image (DEPRECATED)"
gate: PASS
status_reason: "DEPRECATED - Story superseded by public testnet integration. Original gate passed with all 10 acceptance criteria met."
reviewer: "Quinn (Test Architect)"
updated: "2026-01-31T12:00:00Z"

waiver: { active: false }

top_issues: []

risk_summary:
  totals: { critical: 0, high: 0, medium: 0, low: 0 }
  recommendations:
    must_fix: []
    monitor: []

quality_score: 100
expires: "2026-02-14T00:00:00Z"

evidence:
  tests_reviewed: 5
  risks_identified: 0
  trace:
    ac_covered: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    ac_gaps: []

nfr_validation:
  security:
    status: PASS
    notes: "Secrets handled via GitHub Secrets; no hardcoded credentials; proper permissions scoping"
  performance:
    status: PASS
    notes: "120-min timeout for ARM64 builds; GHA cache enabled; concurrency control"
  reliability:
    status: PASS
    notes: "Manifest verification; CLI check; smoke test; concurrent run prevention"
  maintainability:
    status: PASS
    notes: "Clear step names; documented secrets; follows ci.yml patterns"

recommendations:
  immediate: []
  future:
    - action: "Consider self-hosted ARM64 runner if QEMU builds exceed timeout regularly"
      refs: ["docs/stories/28.3.story.md:479-481"]

verification_details:
  acceptance_criteria:
    ac1:
      description: "Workflow builds for both linux/arm64 and linux/amd64"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:86 - platforms: linux/amd64,linux/arm64"
    ac2:
      description: "Image pushed to Docker Hub and GHCR"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:72-74 - dual registry push"
    ac3:
      description: "Manifest shows both architectures"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:94-108 - manifest verification step"
    ac4:
      description: "Image contains aptos and aptos-node binaries"
      status: PASS
      evidence: "docker/aptos/Dockerfile:71-72 - COPY binaries; workflow:126 - version check"
    ac5:
      description: "Image size under 500MB"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:115-123 - size validation step"
    ac6:
      description: "aptos --version health check passes"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:126 - docker run --rm ... --version"
    ac7:
      description: "Local testnet starts successfully"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:129-160 - smoke test with REST API"
    ac8:
      description: "Manual trigger via workflow_dispatch"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:15-20 - workflow_dispatch trigger"
    ac9:
      description: "Weekly schedule"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:21-23 - cron: 0 0 * * 0"
    ac10:
      description: "Accepts APTOS_VERSION input"
      status: PASS
      evidence: ".github/workflows/build-aptos-image.yml:16-20, 90 - version input and build-arg"
