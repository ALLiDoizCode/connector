# Development Dockerfile for ILP Connector
# This Dockerfile is optimized for local development with hot-reload support
# For production, use the multi-stage Dockerfile in the project root

FROM node:22-alpine

# Set working directory
WORKDIR /app

# Install development dependencies for hot-reload
RUN npm install -g nodemon ts-node

# Copy package files for dependency installation
# Root workspace configuration
COPY package.json package-lock.json tsconfig.base.json ./

# Connector package files
COPY packages/connector/package.json packages/connector/tsconfig.json ./packages/connector/

# Shared package files
COPY packages/shared/package.json packages/shared/tsconfig.json ./packages/shared/

# Install all dependencies including devDependencies
# Development mode requires TypeScript compiler and ts-node for hot-reload
RUN npm ci --workspaces

# Copy source code
# Note: Volume mounts will override these for hot-reload
COPY packages/connector/src ./packages/connector/src
COPY packages/shared/src ./packages/shared/src

# Set development environment
ENV NODE_ENV=development

# Expose ports
EXPOSE 3000
EXPOSE 8080

# Start command using nodemon for hot-reload
# nodemon watches for file changes and automatically restarts the application
CMD ["nodemon", "--config", "packages/connector/nodemon.json", "packages/connector/src/index.ts"]
